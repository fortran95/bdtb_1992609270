var UiBubbleTipBase=function(b){var a={content:"",arrow_dir:"up",bubble_css:{width:170},arrow_pos:{},attr:"",wrap:$("body"),closeBtn:false,level:1,arrowReq:true};this._option=$.extend(true,a,b);this._event={};this.init()};UiBubbleTipBase.bubbles={};UiBubbleTipBase.count=0;UiBubbleTipBase.prototype={constructor:UiBubbleTipBase,init:function(a){this.buildBubble()},buildBubble:function(){var a=this._option;_html=this.genericTpl(),wrap=a.wrap;this.j_bubble=$(_html);wrap.append(this.j_bubble);this.j_bubble.css(a.bubble_css);this.j_bubble.find(".j_ui_triangle").css(a.arrow_pos);this.j_bubble.find(".j_body").html(a.content);if(a.arrow_dir=="up"||a.arrow_dir=="down"){this.j_bubble.find(".j_content").css({width:a.bubble_css["width"]})}else{this.j_bubble.find(".j_content").css({width:(a.bubble_css["width"]-7)})}if(a.closeBtn){this.j_bubble.find(".j_close").show()}if(!a.arrowReq){this.hideArrow()}this._bindEvent();this.cid="bubble_"+UiBubbleTipBase.count;UiBubbleTipBase.count++},_bindEvent:function(){var b=this._option,a=this;if(b.closeBtn){this.j_bubble.find(".j_close").click(function(){var c=a.triggerEvent("onclose");if(!c){return}a.closeBubble()})}},bind:function(b,a,c){var d={stat:c?true:false,fun:a};if(this._event[b]){this._event[b].push(d)}else{this._event[b]=[];this._event[b].push(d)}},triggerEvent:function(a){var d=true;if(this._event[a]){var c=this._event[a];for(var b=0;b<c.length;b++){if(c[b].fun){c[b].fun()}if(!c[b].stat){d=false}}}return d},genericTpl:function(){var a=this._option.attr,b=this._option.arrow_dir;_html='<div class="ui_bubble_wrap j_wrap" '+a+' style="display:none;"><div class="j_content ui_bubble_content ui_bubble_'+b+'"><div class="ui_bubble_body j_body"></div><div class="ui_bubble_closed j_close"></div></div><div class="j_ui_triangle ui_triangle ui_triangle_'+b+'"><div class="ui_triangle_outter ui_arrow_o_'+b+'" ><em>◆</em></div><div class="ui_triangle_inner ui_arrow_i_'+b+'" ><em>◆</em></div></div></div>';return _html},closeBubble:function(){this.j_bubble.remove();delete UiBubbleTipBase.bubbles[this.cid];delete this},hideArrow:function(){this.j_bubble.find(".ui_triangle")},hideBubble:function(){this.j_bubble.hide()},showBubble:function(a){if(a){if(a.zIndex){this._getBubbleInfo(a.zIndex);this.j_bubble.css({"z-index":a.zIndex});this.showByTime(a.type,a.time)}else{this._getBubbleInfo();var b=this._handleCover();if(!b){this.showByTime(a.type,a.time)}}}else{this._getBubbleInfo();var b=this._handleCover();if(!b){this.j_bubble.show()}}},showByTime:function(b,c){var a=this;if(b=="delayShow"){setTimeout(function(){a.j_bubble.show()},c)}else{if(b=="delayClose"){a.j_bubble.show();setTimeout(function(){a.closeBubble()},c)}else{a.j_bubble.show()}}},_getBubbleInfo:function(d){var b=this,h=b.j_bubble,c=h.width();h.width(0);h.show();var g=h.offset(),f=g.top,e=g.left,a=h.find(".j_body").height()+12;h.hide();h.width(c);b.minL=e;b.maxL=e+c;b.minT=f;b.maxT=f+a;if(d){b.bubbleType="inter"}UiBubbleTipBase.bubbles[b.cid]=b},_isCover:function(){var d=this,f=d.cid,c=UiBubbleTipBase.bubbles,b=d;for(var e in c){if(e==f||d.bubbleType=="inter"||c[e].j_bubble.get(0).style.display=="none"){}else{var a=c[e];if(b.minL<a.maxL&&b.maxL>a.minL&&b.minT<a.maxT&&b.maxT>a.minT){return a}}}return false},_handleCover:function(){var d=this._isCover(),b=this;if(d){var c=d._option.level,a=b._option.level;if(a>c){d.j_bubble.hide();return false}else{return true}}return false},setBubblePosition:function(a){if(a&&(a.top||a.left)){this.j_bubble.css(a)}},setBubbleFixed:function(){if(!($.browser.msie&&$.browser.version=="6.0")){this.j_bubble.addClass("ui_bubble_wrap_fixed")}else{this.j_bubble.addClass("ui_bubble_fixed_hack")}},setBubbleNormal:function(){if(!($.browser.msie&&$.browser.version=="6.0")){this.j_bubble.removeClass("ui_bubble_wrap_fixed")}else{this.j_bubble.removeClass("ui_bubble_fixed_hack")}},setFixedForMessage:function(){var a=this,b;if(b){clearTimeout(b)}$(window).bind("scroll",function(){if(b){clearTimeout(b)}b=setTimeout(function(){a._bubleFixedSet()},200)})},_bubleFixedSet:function(){var a=this,b=$(window).scrollTop(),c=this._option;if(b>35){a.setBubbleFixed();if(!($.browser.msie&&$.browser.version=="6.0")){a.j_bubble.animate({top:-5},300)}a.j_bubble.find(".ui_triangle").hide()}else{a.setBubbleNormal();a.j_bubble.animate({top:(c.bubble_css["top"]||20)},300);a.j_bubble.find(".ui_triangle").show()}}};var PopWindow=function(b){var a={styleId:1,templateObj:{title:"无",content:"无",button:"无",note:"无",link:"#"}};this._option=$.extend(true,a,b);this._event={}};PopWindow.prototype={constructor:PopWindow,bind:function(b,a,c){var d={stat:c?true:false,fun:a};if(this._event[b]){this._event[b].push(d)}else{this._event[b]=[];this._event[b].push(d)}},trigger:function(a){if(this._event[a]){var c=this._event[a];for(var b=0;b<c.length;b++){if(c[b].fun){c[b].fun()}if(!c[b].stat){return false}}}return true},_buildHtml:function(){var b=this;if($("#pop_frame").length>0){return false}var e=this._option;var d=$("#j_popWindow_tpl_"+e.styleId).html();var c=e.templateObj.title;e.templateObj.title=c+b._sayHi();var a=$.tb.format(d,e.templateObj);this.PopupContainer=document.createElement("div");this.PopupContainer.id="pop_frame";this.PopupContainer.innerHTML=a;document.body.appendChild(this.PopupContainer);setTimeout(function(){b._setAnimation();b._eventInit()},200)},_setAnimation:function(){var a=$("#pop_animate"),b=a.outerHeight();$("#pop_frame").css({height:(b+2)+"px"});a.css({height:b+"px",top:b+"px"}).animate({top:"0px"},"slow")},_sayHi:function(){var a="";var b=new Date().getHours();if(b>=0&&b<5){a="："}else{if(b>=5&&b<9){a="，早上好："}else{if(b>=9&&b<12){a="，上午好："}else{if(b>=12&&b<14){a="，中午好："}else{if(b>=14&&b<18){a="，下午好："}else{if(b>=18&&b<24){a="，晚上好："}}}}}}return a},_eventInit:function(){var c=this,b=$("#pop_frame");b.find(".pop_close").click(function(){var d=c.trigger("closeSuccess");if(!d){return}$("#pop_frame").remove();return false});var a=b.find(".pop_button");a.click(function(){var d=c.trigger("clickBtn");if(!d){return}$("#pop_frame").remove()});a.mousedown(function(){$(this).removeClass("pop_button_normal pop_button_hover").addClass("pop_button_down");$(this).find("span").removeClass("btn_right_part_normal btn_right_part_hover").addClass("btn_right_part_down")});a.hover(function(){$(this).removeClass("pop_button_normal pop_button_hover").addClass("pop_button_hover");$(this).find("span").removeClass("btn_right_part_normal btn_right_part_down").addClass("btn_right_part_hover")},function(){$(this).removeClass("pop_button_down pop_button_hover").addClass("pop_button_normal");$(this).find("span").removeClass("btn_right_part_hover btn_right_part_down").addClass("btn_right_part_normal")})},showPop:function(){var a=this;a._buildHtml()}};