var bdPass=bdPass||{};bdPass.api=bdPass.api||{};bdPass.api.params=bdPass.api.params||{};bdPass.api.params.loginLite_token="";bdPass.api.params.loginLite_codestring="";bdPass.api.loginLite=bdPass.api.loginLite||(function(){if(typeof(bdPass_api_loginLite_userCallBack)!="function"){throw new Error("\u60a8\u5fc5\u987b\u6309\u7167\u4f7f\u7528\u6587\u6863\u5185\u7684\u683c\u5f0f\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u540d\u4e3a'bdPass_api_loginLite_userCallBack'\u7684\u56de\u8c03\u51fd\u6570");return}var passUrl="https://passport.baidu.com/",formAction=passUrl+"v2/api/?login",getInfoUrl=passUrl+"v2/api/?loginliteinfo",_getNewVerifyCodeUrl=passUrl+"v2/?reggetcodestr&callback=",verifycodeImgUrlFront="https://passport.baidu.com/cgi-bin/genimage?",formIdFront="pass_loginLite_form",codeStringPIdFront="pass_loginLite_p_verifycode",changeVerifycodeAIdFront="pass_loginLite_a_verifycode",verifycodeImgWrapperIdFront="pass_loginLite_verifycodeImg_wrapper",errShowerDomIdFront="pass_loginLite_err",hiddenInputIdFront="pass_loginLite_hidden_",phoneNumberExp=/^\d{1,11}$/,emptyFunc=function(){},pageCharset=document.charset||document.characterSet||"UTF-8",conf={staticpage:"",tpl:"",onSubmitStart:emptyFunc,onSubmitedErr:emptyFunc,onSuccess:function(){location.reload()},onInputOk:emptyFunc,onInputErr:emptyFunc,onFormReady:emptyFunc},ErrHash={"1":"\u5e10\u53f7\u683c\u5f0f\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165","2":"\u6b64\u5E10\u53f7\u4e0d\u5b58\u5728","120011":"\u8bf7\u586b\u5199\u5E10\u53f7","4":"\u767b\u5f55\u5bc6\u7801\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165","120012":"\u8bf7\u586b\u5199\u5bc6\u7801","6":"\u9a8c\u8bc1\u7801\u4e0d\u5339\u914d\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u9a8c\u8bc1\u7801","257":"\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801","5":"\u60a8\u5c1d\u8bd5\u767b\u5f55\u6b21\u6570\u8fc7\u4e8e\u9891\u7e41\uff0c\u8bf724\u5c0f\u65f6\u540e\u518d\u8bd5","16":"\u5bf9\u4e0d\u8d77\uff0c\u60a8\u73b0\u5728\u65e0\u6cd5\u767b\u5f55","100005":"\u6b64\u5e10\u53f7\u5df2\u767b\u5f55\u4eba\u6570\u8fc7\u591a","110024":"\u6b64\u5E10\u53f7\u8fd8\u672a\u6fc0\u6d3b\uff0c\u8bf7\u5230\u9a8c\u8bc1\u90ae\u4ef6\u4e2d\u6fc0\u6d3b\uff0c\u6216\u8005\u91cd\u53d1\u9a8c\u8bc1\u90ae\u4ef6","-1":"\u767b\u5f55\u65f6\u53d1\u751f\u672a\u77e5\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165"},formHash={};var g=function(id){return document.getElementById(id)};var setAttrs=function(dom,objAttrs){for(var attr in objAttrs){dom.setAttribute(attr,objAttrs[attr])}};var bindEvent=function(dom,eventType,func){if(dom.addEventListener){bindEvent=function(dom,eventType,func){dom.addEventListener(eventType,func,false)}}else{if(dom.attachEvent){bindEvent=function(dom,eventType,func){dom.attachEvent("on"+eventType,func)}}else{bindEvent=function(dom,eventType,func){dom["on"+eventType]=func}}}bindEvent(dom,eventType,func)};var bindEvents=function(dom,objEvents){if(!objEvents){return}for(var eventType in objEvents){bindEvent(dom,eventType,objEvents[eventType])}};var getEventDom=function(e){var e=e||window.event;return e.target||e.srcElement};var handleErr=function(errno,formIndex){var errWords=ErrHash[errno.toString()];if(errWords){formHash[formIndex].errShowerDom.innerHTML=errWords}else{formHash[formIndex].errShowerDom.innerHTML=ErrHash["-1"]}};var getFormIndexById=function(id){return/\d+$/.exec(id)[0]};var submitCheck=function(formOrEvent,isForm){var token=bdPass.api.params.loginLite_token,form=(isForm===true)?formOrEvent:formHash[getFormIndexById(this.id)];if(token){var inputs=form.inputs;for(var input in inputs){if(inputs[input].validCheck()){continue}else{return false}}form.hiddenInputsDoms.token.value=token;form.hiddenInputsDoms.codestring.value=bdPass.api.params.loginLite_codestring;form.onSubmitStart(form.formIndex);return true}else{form.getServerInfoOrIsVerifyCodeNeed(true);return false}};var handleCodestring=function(codestring,form){if(codestring&&codestring!="undefined"){bdPass.api.params.loginLite_codestring=codestring;form.hasCodeStringState()}else{bdPass.api.params.loginLite_codestring="";form.noCodeStringState()}};var Form=function(formIndex){this.formIndex=formIndex;this.dom=g(formIdFront+formIndex);this.attrs={action:formAction,method:"post"};this.inputs={};this.hiddenInputsDoms={};this.isPhone=false;this.codeStringP=g(codeStringPIdFront+formIndex);this.verifycodeImg=null;this.verifycodeImgWrapper=g(verifycodeImgWrapperIdFront+formIndex);this.changeVerifycodeA=g(changeVerifycodeAIdFront+formIndex);this.errShowerDom=g(errShowerDomIdFront+formIndex);this.hiddens={charset:pageCharset,isPhone:false,index:formIndex,safeflg:0,staticpage:conf.staticpage,loginType:1,tpl:conf.tpl,codestring:"",token:"",callback:"parent.bdPass.api.loginLite._submitCallBack"};this.onSubmitStart=conf.onSubmitStart;this.onSubmitedErr=conf.onSubmitedErr;this.onSuccess=conf.onSuccess;this.onInputOk=conf.onInputOk;this.onInputErr=conf.onInputErr;this.onFormReady=conf.onFormReady};Form.prototype.setAttrs=function(){setAttrs(this.dom,this.attrs);return this};Form.prototype.markHiddens=function(){var d=document,hiddensDocumentFragment=d.createDocumentFragment(),hiddens=this.hiddens;for(var hiddenInputName in hiddens){var hiddenInput=d.createElement("INPUT");hiddenInput.type="hidden";hiddenInput.id=hiddenInputIdFront+hiddenInputName+this.formIndex;hiddenInput.name=hiddenInputName;hiddenInput.value=hiddens[hiddenInputName];this.hiddenInputsDoms[hiddenInputName]=hiddenInput;hiddensDocumentFragment.appendChild(hiddenInput)}this.dom.appendChild(hiddensDocumentFragment);return this};Form.prototype.setVerifycodeImgSrc=function(codestring){if(codestring){bdPass.api.params.loginLite_codestring=codestring}var src=verifycodeImgUrlFront+bdPass.api.params.loginLite_codestring+"&t="+new Date().getTime();if(this.verifycodeImg){this.verifycodeImg.src=src}else{var verifycodeImg=document.createElement("IMG");verifycodeImg.src=src;this.verifycodeImgWrapper.appendChild(verifycodeImg);this.verifycodeImg=verifycodeImg}this.inputs.verifycode.dom.value="";this.hiddenInputsDoms.codestring.value=bdPass.api.params.loginLite_codestring};Form.prototype.phoneState=function(){this.isPhone=true;this.hiddenInputsDoms.isPhone.value=true;this.inputs.username.phoneState();return this};Form.prototype.normalState=function(){this.isPhone=false;this.hiddenInputsDoms.isPhone.value=false;this.inputs.username.normalState();return this};Form.prototype.hasCodeStringState=function(codestring){this.codeStringP.style.display="";this.inputs.verifycode.dom.value="";this.setVerifycodeImgSrc();return this};Form.prototype.noCodeStringState=function(){this.codeStringP.style.display="none";this.inputs.verifycode.dom.value="";return this};Form.prototype.overWirteSubmit=function(){this.dom.onsubmit=submitCheck};Form.prototype.getServerInfoOrIsVerifyCodeNeed=function(immediatelySubmit){if(!bdPass.api.params.loginLite_token&&this.inputs.username.validCheck()){bdPass.api.insertScriptCall(getInfoUrl+"&username="+encodeURIComponent(this.inputs.username.dom.value)+"&isPhone="+this.inputs.username.isPhone+"&tpl="+encodeURIComponent(conf.tpl)+"&immediatelySubmit="+immediatelySubmit+"&index="+this.formIndex+"&t="+new Date().getTime())}else{handleCodestring(bdPass.api.params.loginLite_codestring,this)}};var inputInstanceBuilder=function(type,form,attrs,instanceAttributeOrFunctionObj){var input=new Input(type,form,attrs);for(var attributeOrFunction in instanceAttributeOrFunctionObj){input[attributeOrFunction]=instanceAttributeOrFunctionObj[attributeOrFunction]}return input};var Input=function(type,form,attrs){this.type=type;this.form=form;this.attrs=attrs;this.dom=g("pass_loginLite_input_"+type+form.formIndex);this.events={}};Input.prototype.setAttrs=function(){setAttrs(this.dom,this.attrs);return this};Input.prototype.bindEvents=function(){bindEvents(this.dom,this.events);return this};Input.prototype.validCheck=function(){return true};Input.prototype.emptyCheck=function(emptyErrno){var type=this.type;if(type=="isMem"){throw new Error("type\u4e3aisMem\u7684input\u5b9e\u4f8b\u4e0d\u80fd\u4f7f\u7528emptyCheck\u65b9\u6cd5")}else{var dom=this.dom,form=this.form;if(dom.value){return true}else{var index=form.formIndex;handleErr(emptyErrno,index);form.onInputErr(dom,emptyErrno,index);return false}}};return{version:"2.0.0",init:function(formInfoArray){for(var i=0,len=formInfoArray.length;i<len;i++){if(typeof(formInfoArray[i])=="number"){formInfoArray[i]={formIndex:formInfoArray[i]}}var index=formInfoArray[i].formIndex,form=formHash[index]=new Form(index);form.markHiddens().setAttrs();var username=form.inputs.username=inputInstanceBuilder("username",form,{name:"username"},{isPhone:false,phoneState:function(){this.isPhone=true},normalState:function(){this.isPhone=false},validCheck:function(){var form=this.form,index=form.formIndex,dom=this.dom,value=dom.value;if(this.emptyCheck(120011)){var isPhone=this.isPhone;if(isPhone){if(phoneNumberExp.test(value)){form.onInputOk(dom,index);return true}else{handleErr(1,index);form.onInputErr(dom,1,index);return false}}else{if(value.length>60){handleErr(1,index);form.onInputErr(dom,1,index);return false}else{form.onInputOk(dom,index);return true;b}}}else{return false}}});var password=form.inputs.password=inputInstanceBuilder("password",form,{name:"password"},{validCheck:function(){return this.emptyCheck(120012)}});password.events.focus=function(e){formHash[getFormIndexById(getEventDom(e).id)].getServerInfoOrIsVerifyCodeNeed(false)};var verifycode=form.inputs.verifycode=inputInstanceBuilder("verifycode",form,{name:"verifycode",maxLength:"4"},{validCheck:function(){if(bdPass.api.params.loginLite_codestring){return this.emptyCheck(257)}else{return true}}});var isMem=form.inputs.isMem=inputInstanceBuilder("isMem",form,{name:"mem_pass"},{});for(var input in form.inputs){form.inputs[input].setAttrs().bindEvents()}bindEvent(form.changeVerifycodeA,"click",function(e){bdPass.api.insertScriptCall(_getNewVerifyCodeUrl+"bdPass.api.loginLite.changeNewVcodeCallback&index="+getFormIndexById(getEventDom(e).id)+"&v="+new Date().getTime());if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}});for(var func in formInfoArray[i]){if(typeof(formInfoArray[i][func])=="function"){form[func]=formInfoArray[i][func]}}form.overWirteSubmit();form.onFormReady(index)}},changeNewVcodeCallback:function(json){if(json.error_no=="110000"){formHash[json.thisIndex].setVerifycodeImgSrc(json.verifystr)}},destroy:function(formIndexArray){for(var i=0,len=formIndexArray.length;i<len;i++){if(formHash[formIndexArray[i]]){formHash[formIndexArray[i]]=null}}},getSuggestFormIndexArray:function(count){var index=0,indexArr=[];while(count){while(formHash[index]){index=parseInt(Math.random()*1000)}formHash[index]=true;indexArr.push(index);count--}return indexArr},setUserConf:function(userConf){if(typeof(userConf)!="object"||typeof(userConf.staticpage)!="string"||typeof(userConf.tpl)!="string"){throw new Error("\u60a8\u5fc5\u987b\u6309\u7167\u6587\u6863\u5185\u7684\u683c\u5f0f\uff0c\u628a\u6240\u9700\u914d\u7f6e\u9879\u7f6e\u7f6e\u4e8e'bdPass_api_loginLite_userCallBack'\u7684\u56de\u8c03\u51fd\u6570\u4e2d\u7684'bdPass.api.loginLite.setUserConf'\u7684\u65b9\u6cd5\u7684\u53c2\u6570\u4e2d");return}for(var item in conf){if(typeof(userConf[item])!="undefined"&&(typeof(userConf[item])==typeof(conf[item]))){conf[item]=userConf[item]}}bdPass.api.loginLite.setUserConf=null},switchToPhoneState:function(formIndex){formHash[formIndex].phoneState()},switchToNormalState:function(formIndex){formHash[formIndex].normalState()},_getInfo:function(objInfo){var form=formHash[objInfo.index];handleCodestring(objInfo.codestring,form);bdPass.api.params.loginLite_token=objInfo.token;if(objInfo.immediatelySubmit&&submitCheck(form,true)){form.dom.submit()}},_submitCallBack:function(objInfo){var errno=objInfo.error.toString(),u=objInfo.u,form=formHash[objInfo.index];var hao123Param=objInfo.hao123Param||"";var sendRequest=function(fn){var list=[];return function(src){var index=list.push(new Image)-1;list[index].onload=function(){fn&&fn();list[index]=list[index].onload=null};list[index].src=src}}();if(errno=="0"){if(hao123Param){var timer=setTimeout(function(){form.onSuccess(form.formIndex,objInfo)},1000);sendRequest("http://user.hao123.com/static/crossdomain.php?bdu="+hao123Param+"&t="+Math.random(),function(){clearTimeout(timer);form.onSuccess(form.formIndex,objInfo)})}else{form.onSuccess(form.formIndex,objInfo)}}else{handleCodestring(objInfo.codestring,form);handleErr(errno,form.formIndex);form.onSubmitedErr(errno,form.formIndex,objInfo)}}}})();bdPass_api_loginLite_userCallBack();bdPass_api_loginLite_loaded=true;(function(){bdPass.api["parent.bdPass.api.loginLite._submitCallBack"]=bdPass.api.loginLite._submitCallBack})();
