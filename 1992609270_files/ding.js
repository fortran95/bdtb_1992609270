_.Module.define({path:"pb/component/Ding",sub:{initial:function(){this.up=$("div.p_ding_up");this.down=$("div.p_ding_down");this.canSubmit=true;this.data=$.parseJSON(this.down.attr("field-data"));this.bindEvents();this.showNum()},bindEvents:function(){var a=this;a.down.html(a.strInner("down"));var b=a.down.find(".d_ding_down");b.bind("mouseenter",function(){a.changeStyle(this,"down","ding_hightlight")}).bind("mouseleave",function(){a.changeStyle(this,"down","ding_default")}).bind("click",function(){a.changeStyle(this,"down","ding_click");a.excute("down")});if(a.up){a.up.html(this.strInner("up"));var c=a.up.find("div.d_ding_up");c.bind("mouseenter",function(){a.changeStyle(this,"up","ding_hightlight")}).bind("mouseleave",function(){a.changeStyle(this,"up","ding_default")}).bind("click",function(){a.changeStyle(this,"up","ding_click");a.excute("up")})}},strInner:function(b){var a=new Array();a.push('<div class="d_ding_'+b+'">');a.push('<div class="d_ding_btn_default">');a.push('<span class="d_ding_text"></span>');a.push("</div>");a.push("</div>");return a.join("")},showNum:function(){var a=this;$("span.d_ding_text").each(function(){var c=""+a.data.num;$(this).text(c);$(this).attr("class","d_ding_text ding_status2");if(c.length>4){var b=c.length*8+18;a.down.find("div.d_ding_btn_default").css({width:b});if(a.up){a.up.find("div.d_ding_btn_default").css({width:b})}}})},showText:function(f,a){var e=$("div.d_ding_"+f),b=e.find("span.d_ding_text"),c=e.find("div.d_ding_btn_default");b.text(a);b.attr("class","d_ding_text ding_status0");var d=a.length*15;if(d>c.width()){c.width(d)}},changeStyle:function(e,f,d){var c=$(e);c.attr("class",d+" d_ding_"+f);var b=c.find("div.d_ding_btn_default");b.attr("class","d_ding_btn_default "+d+"_text");var a=c.find("span.d_ding_text");if(d=="ding_default"){this.showNum()}else{if(d=="ding_hightlight"){if(this.canSubmit){a.text("顶");a.attr("class","d_ding_text ding_status1")}else{a.text("已顶过");a.attr("class","d_ding_text ding_status0");$("div.p_ding_"+f).css("cursor","default");c.unbind("click")}}}},excute:function(d){if(PageData.user.is_login&&PageData.user.no_un){TbCom.process("User","buildUnameFrame","填写用户名","有用户名才能“顶”哟，赶快给自己起一个吧~");return false}var c={ie:"utf-8",datatype:"json",tbs:PageData.tbs,fdir:PageData.first_class,fid:PageData.forum_id,fname:PageData.forum_name,tid:PageData.thread.id,subsource:d,pn:PageData.curr_page_num};var b=this;if(b.canSubmit){$.post("/comment/comment",c,function(e){var f=$.parseJSON(e);if(f){if(f.no==0||f.no==100){b.data.num+=1;b.showText(d,"已顶过")}else{if(f.no==9000){TbCom.process("User","buildUnameFrame","填写用户名","有用户名才能“顶”哟，赶快给自己起一个吧~");return}else{if(f.no==1000){b.showText(d,"已顶过")}else{b.showText(d,"操作失败")}}}b.canSubmit=false}else{b.showText(d,"操作失败")}});if(PageData.thread.is_ad===1){if(document.images){var a=new Image();a.src=PageData.ecomStatDomain+"up.php?forumid="+(PageData.forum_id||"")+"&tid="+(PageData.thread.id||"")+"&userid="+(PageData.user.id||"")+"&username="+(PageData.user_name_url||"")+"&t="+new Date().getTime();a=null}}}else{b.showText(d,"已顶过")}}}});